<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zona Biker - Registro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script defer src="script.js"></script>
</head>
<body class="bg-dark text-white">

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4">
    <a class="navbar-brand" href="#">Zona Biker</a>
    <div class="ms-auto d-flex gap-2">
<a href="/registros-hoy" class="btn btn-primary">📅 Ver Registros de Hoy</a>
<a href="/registros-todos" class="btn btn-dark">📋 Ver Todos los Registros</a>

    </div>
  </nav>

  <div class="container py-4">
    <h2 class="text-center mb-4">Registrar Nuevo Servicio</h2>
<form id="form-registro" class="row g-3 bg-secondary p-4 rounded shadow">

    
  <!-- MARCA -->
<div class="col-md-6">
  <label class="form-label">Marca</label>
  <input class="form-control" name="marca" id="marca" list="lista-marcas" placeholder="Escribe o elige marca" required>
  <datalist id="lista-marcas"></datalist>
</div>


  <!-- MODELO -->
<div class="col-md-6">
  <label class="form-label">Modelo</label>
  <input class="form-control" name="modelo" id="modelo" list="lista-modelos" placeholder="Escribe o elige modelo" required>
  <datalist id="lista-modelos"></datalist>
</div>

  <!-- CILINDRADA (autocompletado) -->
<div class="col-md-4">
  <label class="form-label">Cilindrada</label>
  <input class="form-control" name="cilindrada" id="cilindrada" list="lista-cilindradas" placeholder="Se autocompleta o escribe" required>
  <datalist id="lista-cilindradas"></datalist>
</div>

  <!-- KILOMETRAJE -->
  <div class="col-md-4">
    <label class="form-label">Kilometraje</label>
    <input type="text" class="form-control" name="kilometraje" />
  </div>

  <!-- COSTO -->
  <div class="col-md-4">
    <label class="form-label">Costo</label>
    <input type="number" class="form-control" name="costo" required />
  </div>

  <!-- CLIENTE -->
  <div class="col-md-6">
    <label class="form-label">Cliente</label>
    <input type="text" class="form-control" name="cliente" required />
  </div>

  <!-- EMPLEADO -->
  <div class="col-md-6">
    <label class="form-label">Empleado</label>
    <select name="empleado" class="form-select" required>
      <option value="" disabled selected>Selecciona empleado</option>
      <option value="Kike">Kike (Dueño)</option>
      <option value="Carlos">Jose</option>
      <option value="Luis">Luis</option>
      <option value="Pedro">Pedro</option>
    </select>
  </div>

  <!-- METODO DE PAGO -->
  <div class="col-md-6">
    <label class="form-label">Método de Pago</label>
    <select name="metodo_pago" class="form-select" required>
      <option value="" disabled selected>Elige método de pago</option>
      <option value="Yape">Yape</option>
      <option value="Plin">Plin</option>
      <option value="Transferencia">Transferencia</option>
      <option value="Efectivo">Efectivo</option>
    </select>
  </div>

  <!-- FECHA -->
  <div class="col-md-3">
    <label class="form-label">Fecha</label>
    <input type="date" class="form-control" name="fecha" id="fecha" required />
  </div>

  <!-- HORA -->
  <div class="col-md-3">
    <label class="form-label">Hora</label>
    <input type="time" class="form-control" name="hora" required />
  </div>

  <div class="col-12 text-end">
    <button type="submit" class="btn btn-success">💾 Guardar</button>
  </div>
</form>

<!-- BOTÓN TOGGLE RESUMEN -->
<div class="text-end mt-3">
  <button id="toggle-resumen" class="btn btn-outline-info btn-sm">📊 Mostrar Resumen del Día</button>
</div>

<!-- RESUMEN DIARIO VISUALMENTE POTENTE -->
<div id="resumen-dia" class="mt-4 p-4 rounded-4 shadow-lg glassmorph text-white position-relative overflow-hidden" style="display: none;">
  <h4 class="text-center mb-4 fw-bold text-info border-bottom pb-2">📈 Resumen Diario - Zona Biker</h4>
  
  <div class="row g-4 text-center">
    
    <!-- Total Motos -->
    <div class="col-md-4">
      <div class="stat-card h-100 p-4 rounded-4">
        <h6 class="text-uppercase text-white-50">🛵 Total de Motos</h6>
        <p class="fs-1 fw-bold text-warning mb-0" id="resumen-dia-motos">0</p>
      </div>
    </div>

    <!-- Empleados -->
    <div class="col-md-4">
      <div class="stat-card h-100 p-4 rounded-4">
        <h6 class="text-uppercase text-white-50">👥 Atendidas por Empleado</h6>
        <div id="resumen-empleados" class="text-start mt-2 ps-3 small text-light"></div>
      </div>
    </div>

    <!-- Ganancia -->
    <div class="col-md-4">
      <div class="stat-card h-100 p-4 rounded-4">
        <h6 class="text-uppercase text-white-50">💰 Ganancia Zona Biker</h6>
        <p class="fs-1 fw-bold text-success mb-0">S/<span id="resumen-ganancia">0.00</span></p>
      </div>
    </div>

  </div>

  <style>
    .glassmorph {
      background: rgba(255, 255, 255, 0.07);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .stat-card {
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.4), rgba(40, 40, 40, 0.6));
      border: 1px solid rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    }

    #resumen-empleados p {
      margin-bottom: 0.4rem;
      font-weight: 500;
      color: #e0e0e0;
    }

    @media (max-width: 768px) {
      .fs-1 {
        font-size: 1.75rem !important;
      }
    }
  </style>
</div>




<script>
async function cargarResumenDiario() {
  try {
    const res = await fetch('/api/registros/hoy');
    const datos = await res.json();

    if (!Array.isArray(datos)) return;

    const totalMotos = datos.length;
    let totalGanancia = 0;
    const empleados = {};

    datos.forEach(r => {
      const empleado = r.empleado || 'Desconocido';
      const costo = parseFloat(r.costo || 0);

      empleados[empleado] = (empleados[empleado] || 0) + 1;

      if (empleado !== 'Kike') {
        totalGanancia += costo * 0.5;
      }
    });

    document.getElementById('resumen-dia-motos').textContent = totalMotos;
    document.getElementById('resumen-ganancia').textContent = totalGanancia.toFixed(2);

    const contenedor = document.getElementById('resumen-empleados');
    contenedor.innerHTML = '';

    Object.entries(empleados).forEach(([nombre, cantidad]) => {
      const p = document.createElement('p');
      p.className = 'mb-1';
      p.innerHTML = `${nombre}: <span class="fw-bold">${cantidad}</span>`;
      contenedor.appendChild(p);
    });

  } catch (err) {
    console.error('Error cargando resumen del día:', err);
  }
}

window.addEventListener('DOMContentLoaded', () => {
  cargarResumenDiario();

  const btnToggle = document.getElementById('toggle-resumen');
  const resumen = document.getElementById('resumen-dia');

  btnToggle.addEventListener('click', () => {
    if (resumen.style.display === 'none') {
      resumen.style.display = 'block';
      btnToggle.textContent = '❌ Ocultar Resumen del Día';
    } else {
      resumen.style.display = 'none';
      btnToggle.textContent = '📊 Mostrar Resumen del Día';
    }
  });
});
</script>




</body>
</html>
